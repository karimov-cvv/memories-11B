<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ê—Ä—Ö–∏–≤ 11–ë | Premium Edition</title>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <script>
        // --- –°–ò–°–¢–ï–ú–ê –î–û–°–¢–£–ü–ê ---
        var validCodes = ['greenflagbek', 'shamasportik', 'inlovenargiza', 'durdonaxola', 'samiraxon', 'istoraxon']; 
        var userPass = prompt('–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –∫–æ–¥ –¥–æ—Å—Ç—É–ø–∞:');
        if (!validCodes.includes(userPass)) {
            document.write('<body style="background:#f5ebe0;text-align:center;padding-top:100px;font-family:sans-serif;color:#4e3b31;"><h1>‚ùå –û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞</h1><p>–ö–æ–¥ –Ω–µ–≤–µ—Ä–Ω—ã–π.</p><button onclick="location.reload()" style="padding:10px 20px; border-radius:10px; border:none; background:#8b5e3c; color:white;">–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞</button></body>');
            window.stop();
        }
    </script>
    
    <style>
        :root {
            --primary: #8b5e3c;
            --bg: #f5ebe0;
            --glass: rgba(255, 255, 255, 0.85);
        }

        html, body { margin: 0; padding: 0; height: 100%; background-color: var(--bg); overflow: hidden; font-family: 'Segoe UI', sans-serif; }
        
        /* –ö–û–ù–¢–ï–ô–ù–ï–† TIKTOK */
        .tiktok-container { 
            height: 100vh; 
            overflow-y: scroll; 
            scroll-snap-type: y mandatory; 
            scroll-behavior: smooth;
            -webkit-overflow-scrolling: touch;
        }
        
        .section { 
            height: 100vh; width: 100%; 
            scroll-snap-align: start; 
            scroll-snap-stop: always;
            display: flex; flex-direction: column; justify-content: center; align-items: center; 
            position: relative;
        }

        .media-wrapper {
            position: relative;
            width: 92%;
            max-height: 55vh;
            display: flex;
            justify-content: center;
            background: #000;
            border-radius: 12px;
            overflow: hidden;
            border: 4px solid #fff;
            box-shadow: 0 15px 35px rgba(0,0,0,0.2);
        }

        video, img { 
            max-width: 100%; max-height: 55vh; 
            object-fit: contain;
        }

        .video-label { 
            font-weight: 800; color: var(--primary); 
            margin-bottom: 10px; text-transform: uppercase; font-size: 13px; letter-spacing: 1px;
        }

        /* –ë–õ–û–ö –ö–û–ú–ú–ï–ù–¢–ê–†–ò–ï–í –ò –õ–ê–ô–ö–û–í */
        .comment-box {
            width: 88%; max-width: 380px; 
            background: var(--glass);
            margin-top: 15px; padding: 15px; border-radius: 24px;
            backdrop-filter: blur(15px);
            box-shadow: 0 8px 32px rgba(139, 94, 60, 0.1);
        }

        .like-row {
            display: flex; align-items: center; gap: 8px; margin-bottom: 10px;
        }

        .like-btn {
            background: none; border: none; font-size: 22px; cursor: pointer; transition: transform 0.2s; padding: 0;
        }
        .like-btn:active { transform: scale(1.4); }
        .like-count { font-weight: bold; color: var(--primary); font-size: 15px; }

        .comment-list {
            height: 100px; overflow-y: auto; font-size: 13px; margin-bottom: 12px;
            text-align: left; border-bottom: 1px solid rgba(0,0,0,0.05);
        }

        .comment-item { margin-bottom: 6px; padding: 4px 8px; background: rgba(255,255,255,0.4); border-radius: 8px; }
        .comment-item b { color: var(--primary); }

        .input-row { display: flex; gap: 6px; }
        input { 
            padding: 10px; border-radius: 10px; border: 1px solid rgba(0,0,0,0.05); 
            outline: none; font-size: 13px; 
        }
        .inp-name { width: 70px; }
        .inp-text { flex-grow: 1; }
        
        .send-btn { 
            background: var(--primary); color: white; border: none; 
            width: 40px; border-radius: 10px; cursor: pointer; font-size: 16px;
        }

        /* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ */
        .loader {
            position: absolute; color: white; font-size: 12px; z-index: -1;
        }
    </style>
</head>
<body>

<div class="tiktok-container" id="main-container"></div>

<script>
    // --- –ù–ê–°–¢–†–û–ô–ö–ò FIREBASE ---
    const firebaseConfig = {
        apiKey: "AIzaSyC6VJneixoX29fkyAkB8Xn784fC-f6X36U",
        authDomain: "archive-11b.firebaseapp.com",
        databaseURL: "https://archive-11b-default-rtdb.firebaseio.com",
        projectId: "archive-11b",
        storageBucket: "archive-11b.firebasestorage.app",
        messagingSenderId: "133107956700",
        appId: "1:133107956700:web:7f4d682490df09b5784f1a"
    };
    
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    // --- –¢–í–û–ô –ö–û–ù–¢–ï–ù–¢ (–í–∏–¥–µ–æ –∏ –§–æ—Ç–æ) ---
    const contentList = [
        // –°—Ç–∞—Ä—ã–µ –≤–∏–¥–µ–æ
        { id: "2", type: "video" }, { id: "7", type: "video" }, { id: "8", type: "video" }, 
        { id: "10", type: "video" }, { id: "11", type: "video" }, { id: "12", type: "video" },
        { id: "13", type: "video" }, { id: "14", type: "video" }, { id: "15", type: "video" },
        { id: "17", type: "video" }, { id: "18", type: "video" }, { id: "19", type: "video" },
        { id: "20", type: "video" },
        // –ù–æ–≤—ã–µ –≤–∏–¥–µ–æ
        { id: "21", type: "video" }, { id: "22", type: "video" }, { id: "23", type: "video" }, { id: "24", type: "video" },
        // –§–æ—Ç–æ
        { id: "1", type: "image" }, { id: "2", type: "image" }, { id: "3", type: "image" },
        { id: "4", type: "image" }, { id: "5", type: "image" }, { id: "6", type: "image" },
        { id: "7", type: "image" }, { id: "8", type: "image" }, { id: "9", type: "image" },
        { id: "10", type: "image" }, { id: "11", type: "image" }, { id: "12", type: "image" }
    ];

    const container = document.getElementById('main-container');

    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤
    contentList.forEach(item => {
        const section = document.createElement('div');
        section.className = 'section';
        
        let mediaHtml = item.type === 'video' 
            ? `<video loop playsinline muted preload="none" data-src="vid${item.id}.mp4"></video>`
            : `<img data-src="img${item.id}.jpg">`;

        section.innerHTML = `
            <div class="video-label">${item.type === 'video' ? 'üìΩ –ú–û–ú–ï–ù–¢' : 'üì∏ –§–û–¢–û'} #${item.id}</div>
            <div class="media-wrapper">
                <div class="loader">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                ${mediaHtml}
            </div>
            <div class="comment-box">
                <div class="like-row">
                    <button class="like-btn" onclick="addLike('${item.type}${item.id}')">‚ù§Ô∏è</button>
                    <span class="like-count" id="likes-${item.type}${item.id}">0</span>
                </div>
                <div class="comment-list" id="list-${item.type}${item.id}"></div>
                <div class="input-row">
                    <input type="text" id="name-${item.type}${item.id}" class="inp-name" placeholder="–ò–º—è">
                    <input type="text" id="text-${item.type}${item.id}" class="inp-text" placeholder="–¢–µ–∫—Å—Ç...">
                    <button class="send-btn" onclick="sendComment('${item.type}${item.id}')">‚ÜóÔ∏è</button>
                </div>
            </div>
        `;
        container.appendChild(section);
        loadComments(item.type + item.id);
        loadLikes(item.type + item.id);
    });

    // --- –õ–û–ì–ò–ö–ê TIKTOK + –õ–ï–ù–ò–í–ê–Ø –ó–ê–ì–†–£–ó–ö–ê ---
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            const media = entry.target.querySelector('video, img');
            if (!media) return;

            if (entry.isIntersecting) {
                // –ü–æ–¥–≥—Ä—É–∂–∞–µ–º —Ñ–∞–π–ª —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ –æ–Ω –Ω–∞ —ç–∫—Ä–∞–Ω–µ
                if (media.dataset.src) {
                    media.src = media.dataset.src;
                    delete media.dataset.src;
                }
                
                if (media.tagName === 'VIDEO') {
                    media.play().catch(() => {
                        media.muted = true;
                        media.play();
                    });
                }
            } else {
                if (media.tagName === 'VIDEO') media.pause();
            }
        });
    }, { threshold: 0.6 });

    document.querySelectorAll('.section').forEach(s => observer.observe(s));

    // --- –§–£–ù–ö–¶–ò–ò FIREBASE ---
    function sendComment(id) {
        const nameInp = document.getElementById('name-' + id);
        const textInp = document.getElementById('text-' + id);
        if (!textInp.value.trim()) return;

        database.ref('comments/' + id).push({
            name: nameInp.value.trim() || "–ê–Ω–æ–Ω–∏–º",
            text: textInp.value.trim()
        });
        textInp.value = "";
    }

    function loadComments(id) {
        const listDiv = document.getElementById('list-' + id);
        database.ref('comments/' + id).on('value', (snapshot) => {
            listDiv.innerHTML = "";
            const data = snapshot.val();
            if (data) {
                Object.values(data).forEach(c => {
                    const item = document.createElement('div');
                    item.className = 'comment-item';
                    item.innerHTML = `<b>${c.name}:</b> ${c.text}`;
                    listDiv.appendChild(item);
                });
                listDiv.scrollTop = listDiv.scrollHeight;
            } else {
                listDiv.innerHTML = "<div style='color:#aaa; text-align:center; padding-top:20px; font-size:11px;'>–ù–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤</div>";
            }
        });
    }

    function addLike(id) {
        database.ref('likes/' + id).transaction(c => (c || 0) + 1);
    }

    function loadLikes(id) {
        const countSpan = document.getElementById('likes-' + id);
        database.ref('likes/' + id).on('value', (s) => {
            countSpan.innerText = s.val() || 0;
        });
    }
</script>

</body>
</html>
